<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Language REPL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
        }
        #output {
            width: 100%;
            height: 200px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto; /* Enable vertical scrolling */
        }
        /* Modal styles */
        #inputModal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        #inputModalContent {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 30%;
        }
        #inputModalHeader {
            color: #888;
            text-align: center;
            font-size: 18px;
            margin-bottom: 10px;
        }
        #inputModalInput {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        #inputModalButton {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 100%;
        }
        #inputModalButton:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>Simple Language REPL</h1>
    <textarea id="input" placeholder="Enter your Simple Language code here...">
print "Hello, World!"
x = 5
y = 3
print x + y

print "Enter your name: " read name
print "Hello, " & name

print name & ", I'm going to sing to you."
for(i = 99; i > 0; i = i - 1) do
    if i == 1 then
        print "1 bottle of beer on the wall, 1 bottle of beer."
        return
    else
      print i & " bottles of beer on the wall, " & i & " bottles of beer."
    end
end
    </textarea>
    <button id="run">Run</button>
    <button id="clear">Clear</button> <div id="output"></div>

    <!-- Modal -->
    <div id="inputModal">
        <div id="inputModalContent">
            <div id="inputModalHeader">Enter Input</div>
            <input type="text" id="inputModalInput">
            <button id="inputModalButton">Submit</button>
        </div>
    </div>

    <p>For more information about the Simple Language Syntax, see the <a href="help.html">Help page</a>.</p>
    <p>For more information about this project, see the <a href="http://github.com/dolan/simple3-repl-js">Github Repo</a>.</p>

    <script src="js/simple.js"></script>
    <script src="js/interpreter.js"></script>
    <script>
        const inputElement = document.getElementById('input');
        const outputElement = document.getElementById('output');
        const runButton = document.getElementById('run');
        const clearButton = document.getElementById('clear'); // Get the clear button element
        const inputModal = document.getElementById('inputModal');
        const inputModalInput = document.getElementById('inputModalInput');
        const inputModalButton = document.getElementById('inputModalButton');

        function appendOutput(text) {
            outputElement.textContent += text + '\n';
        }

        function showInputModal(promptMessage) {
            inputModalInput.value = ''; // Clear previous input
            inputModalHeader.textContent = promptMessage;
            inputModal.style.display = 'block';
        }

        function hideInputModal() {
            inputModal.style.display = 'none';
        }

        inputModalButton.addEventListener('click', () => {
            const inputValue = inputModalInput.value;
            hideInputModal();
            appendOutput(inputValue); // Append the input to the output
            return inputValue; // Return the input value
        });

        runButton.addEventListener('click', () => {
            outputElement.textContent = ''; // Clear previous output
            const code = inputElement.value;
            try {
                if (typeof simpleParser === 'undefined') {
                    throw new Error('Simple parser is not defined. Make sure simple.js is loaded correctly.');
                }
                if (typeof Interpreter === 'undefined') {
                    throw new Error('Interpreter is not defined. Make sure interpreter.js is loaded correctly.');
                }
                const ast = simpleParser.parse(code);
                const interpreter = new Interpreter(appendOutput, showInputModal); // Pass showInputModal as the inputCallback
                interpreter.interpret(ast);
            } catch (error) {
                appendOutput('Error: ' + error.message);
                console.error(error); // Log the full error to the console for debugging
            }
        });

        clearButton.addEventListener('click', () => {
            outputElement.textContent = ''; // Clear the output
        });
    </script>
</body>
</html>
